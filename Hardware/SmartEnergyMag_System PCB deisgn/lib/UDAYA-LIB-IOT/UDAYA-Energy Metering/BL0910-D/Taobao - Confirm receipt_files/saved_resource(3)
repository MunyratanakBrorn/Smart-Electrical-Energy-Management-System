KISSY.add("tbc/search-suggest/1.4.7/suggest",function(e,t){function r(e){r.superclass.constructor.call(this,e||{})}return r=t.extend({initializer:function(){var e=this;e.on("afterRenderData",function(){e.fire("beforeShow")})},sendRequest:function(e){var t=this,r=t.constructor.superclass.sendRequest;if(t.fire("beforeQueryChange",{query:e})===!1)return!1;t.queryTimer&&clearTimeout(t.queryTimer),t.laterTimer&&clearTimeout(t.laterTimer);var n=arguments;t.queryTimer=setTimeout(function(){t.queryTimer=null,t.laterTimer=setTimeout(function(){t.later=!1},500),r.apply(t,n)},t.later?200:50),t.later=!0},handleKeyDownInternal:function(e){var t=this,r=t.constructor.superclass.handleKeyDownInternal;return t.fire("beforeKeyDown",{event:e})===!1?!1:void r.apply(this,arguments)},handleKeyEventInternal:function(e){var t=this,r=t.constructor.superclass.handleKeyEventInternal;return t.fire("beforeKeyDown",{event:e})===!1?!1:void r.apply(this,arguments)},setValueInternal:function(e){var t=this,r=t.constructor.superclass.setValueInternal;return t.fire("beforeSetInputValue",{event:e})===!1?!1:void r.apply(this,arguments)},setValueFromAutocomplete:function(e){var t=this,r=t.constructor.superclass.setValueFromAutocomplete;return t.fire("beforeSetInputValue",{event:e})===!1?!1:void r.apply(this,arguments)},renderItems:function(t,r,n){var a,u,o=this,s=o.get("sugConfig").resultFormat,i=o.resultArr||(o.resultArr=[]),l="",c=t;e.each(r,function(t,o){if(!t||!t[0])return void r.splice(o,1);for(a=t[0];a.indexOf(c)<0;)c=c.substr(0,c.length-1);""===c?(l=a,a=""):0===a.indexOf(c)&&(l=c,a=a.replace(c,""));for(var f in i)if(u=i[f],u.textContent===t[0]&&u.unique)return;n=n.replace("{format}",s),i.push({textContent:t[0],content:e.substitute(n,{query:l,text:a,index:o+1,count:t[1]}),list:!0})}),o.resultArr=i},alignInternal:function(e){var t=this,r=t.constructor.superclass.alignInternal;return t.fire("beforeShow",{event:e})===!1?!1:void r.apply(this,arguments)}},{ATTRS:{dataSourceCfg:{value:{xhrCfg:{url:"",dataType:"jsonp",scriptCharset:"utf-8",data:{code:"utf-8"}},allowEmpty:!0,paramName:"q",cache:!0}},mods:{value:{},setter:function(e){return e}}}}),r.RemoteDataSource=t.RemoteDataSource,r.LocalDataSource=t.LocalDataSource,r},{requires:["combobox"]});KISSY.add("tbc/search-suggest/1.4.7/mods/mods",function(){return{"new":{tmpl:'<div class="item-wrapper {prefixCls}menu-extras-xp" data-key="q={$queryUrl}&suggest=new_{$index}&tab=shopping&auction_tag[]=1154"><span class="{prefixCls}menu-xp-tag">新品</span><span class="{prefixCls}menu-xp-icon">新品</span><span class="{prefixCls}menu-xp">“{$query}”相关{new}新品</span></div>'},shop:{tmpl:'<div class="item-wrapper {prefixCls}menu-extras-dp" data-action="//shopsearch.taobao.com/search" data-key="q={$queryUrl}&suggest=shop_{$index}"><span class="{prefixCls}menu-dp">{$query} <b>相关店铺</b></span><span class="{prefixCls}menu-dp-icon">店铺</span></div>'},cat:{tmpl:'<div class="{prefixCls}menu-extras-cate" data-key="q={$2}&cat={$1}&suggest=cat_{$index}"><span class="{prefixCls}menu-key">{$2}</span><span class="{prefixCls}menu-cate">在<b>{$0}</b>分类下搜索</span></div>'},list:{tmpl:"<div data-index='{index}' class='item-wrapper' data-key='q={textContent}&suggest=0_{index}'><span class='item-text'>{query}<b>{text}</b></span><span class='item-count'>{format}</span></div>"},global:{tmpl:'<div class="{prefixCls}menu-extras-cate" data-key="q={$queryUrl}&promote=2097152&suggest=global_{$index}"><span class="{prefixCls}menu-key">{$query}</span><span class="{prefixCls}menu-cate">在全球购市场中搜索</span></div>'},history:{tmpl:'<div class="{prefixCls}menu-extras-history" {attr} data-key="q={historyItemQuery}&suggest={extraParam}_{index}" data-index="_his_{index}" data-value="{historyItemValue}"><span class="{prefixCls}menu-history-key">{historyItemValue}</span><span data-type="{extraParam}" class="{prefixCls}menu-history-delete">删除</span></div>'},scene:{tmpl:'<div class="{prefixCls}menu-extras-cate extras-scene" data-action="//fa.taobao.com/search" data-key="q={scene}&suggest=scene_{$index}"><span class="{prefixCls}menu-key">{scene}</span><b>装修宝典/选购秘籍</b></div>'},dapei_bottom:{tmpl:'<div class="item-wrapper {prefixCls}menu-extras-dp" data-source-stat="source_click=suggest_kfc&source_pv=suggest_kfc#!Content" data-action="//pose.taobao.com/search" data-key="q={dapei_bottom}"><span class="{prefixCls}menu-dp">{dapei_bottom}<b>全套搭配</b></span></div>'},dapei_top:{tmpl:'<div class="{prefixCls}menu-extras-cate" data-source-stat="source_click=suggest_jqc&source_pv=suggest_jqc#!Content" data-action="//pose.taobao.com/search" data-key="q={dapei_top}"><span class="{prefixCls}menu-key">{dapei_top}</span><span class="{prefixCls}menu-cate">在<b>搭配</b>下搜索</span></div>'},tmall:{tmpl:'<div class="{prefixCls}menu-extras-cate extras-mall" data-key="q={tmall}&suggest=tmall_{$index}&tab=mall"><span class="{prefixCls}menu-key">{tmall}</span><b>天猫相关</b></div>'},c2c_activity:{tmpl:'<div class="{prefixCls}menu-extras-cate extras-active" data-key="q={c2c_activity_query} {c2c_activity_tag}&suggest=active_{$index}&tab=deal"><span class="{prefixCls}menu-key">{c2c_activity_query}</span><span class="{prefixCls}menu-cate">在 <b>{c2c_activity_tag}</b> 中搜索</span></div>'},showExtra:!1}});KISSY.add("tbc/search-suggest/1.4.7/mods/bts",function(t,e,u){function n(t){n.superclass.constructor.call(this,t||{})}return t.extend(n,e,{getBucket:function(){var t=this,e=t.getCookieT(),u=t.getTestBucket()||t.retBucket(e,20,-4,4)-0;return u},getTestBucket:function(){var t=location.search,e=t.match(/alg_bts=(\d+)/);return e&&e[1]?e[1]-0:void 0},getCookieT:function(){var t=new u,e=t.getCookie("t");return e},retBucket:function(t,e,u,n){return!t&&"0"||this.countBucket(t,e,u,n)},countBucket:function(t,e,u,n){var r=t.substr(u,n),c=parseInt(r,16),s=c%e+1;return s+""}},{ATTRS:{pluginId:{value:"bts"}}}),n},{requires:["base","./utils"]});KISSY.add("tbc/search-suggest/1.4.7/mods/utils",function(e,t){function n(e){return i?i:(n.superclass.constructor.call(this,e||{}),void(i=this))}var i;return e.extend(n,t,{pluginInitializer:function(e){var t=this;t.set("caller",e)},getCookie:function(t){var n=window;if(n.userCookie&&!e.isUndefined(n.userCookie[t]))return n.userCookie[t];if(n.SRP_COOKIES||(n.SRP_COOKIES={})&&e.isUndefined(SRP_COOKIES[t])){var i=document.cookie.match("(?:^|;)\\s*"+t+"=([^;]*)");SRP_COOKIES[t]=i&&i[1]?decodeURIComponent(i[1]):""}return SRP_COOKIES[t]},fireEvent:function(e,t){var n=document;if(n.createEvent){var i=n.createEvent("MouseEvents");i.initEvent(t,!0,!1),e.dispatchEvent(i)}else n.createEventObject&&e.fireEvent("on"+t)}},{ATTRS:{pluginId:{value:"utils"}}}),n},{requires:["base"]});KISSY.add("tbc/search-suggest/1.4.7/mods/stat",function(t,e,n,a,i){function r(t){r.superclass.constructor.call(this,t||{})}return t.extend(r,e,{pluginInitializer:function(t){var e=this,n=e.get("stat");e.set("caller",t),t.on("beforeSubmit",function(t){var n=t.isInitSearch;e.setStat(n)}),n&&(e.sendTongji(),e.bindSearchTrace())},bindSearchTrace:function(){var t=this;a.delegate("body","click","a",t.initSearchTrace,t)},initSearchTrace:function(t){var e=this,n=t.currentTarget,a=n.getAttribute("trace"),i=n.getAttribute("href");if(a)switch(a){case"relatedSearch":e.saveQuery();break;case"auction":var r=e.stat;r&&-1===i.indexOf("initiative_new")&&n.setAttribute("href",i+"&initiative_new=1")}},sendTongji:function(){var t,e=this,n=e.getStatInst();n.checkFlash({onSuccess:function(){t=n.query("stat")[0],t&&t.value&&(e.stat=t.value,e.send("f_stats_show="+t.value,!0))}})},setStat:function(t,e){var n=this,a=n.get("caller"),i=a.query,r=n.saveQuery(i,t);r&&n.send("lf_aclog=null-null-null-null-0&stats_click="+r,e)},getStatInst:function(){var t=this,e=t.get("caller"),n=e.get("sugConfig"),a=n.tab||"",r=new i({name:"stat",tab:a});return r},saveQuery:function(t,e){var n,a,i=this.getStatInst();return e&&t?(n=encodeURIComponent(t),a="initiative_new:1;q:"+n,i.save("stat",a)):i.deleteItem("stat"),a},send:function(t,e){var n,a;e?(n="/tongji",a="H51884970"):(n="/search",a="H51884969"),(window.goldlog_queue||(window.goldlog_queue=[])).push({action:"goldlog.record",arguments:[n,"",t,a]})},renderPlugin:function(){}},{ATTRS:{pluginId:{value:"stat"}}}),r},{requires:["base","cookie","event","../mods/local-query"]});KISSY.add("tbc/search-suggest/1.4.7/mods/local-query",function(t,e,a,s,n){function i(t){i.superclass.constructor.call(this,t||{}),this.initialize()}var r="localQuery";return t.extend(i,e,{initialize:function(){var t=this,e=t.get("name"),a=t.get("tab"),s=t.get("user");"item"===a&&(a="baobei"),t.storageKey=r+e+a+s,t._getStorage()},checkFlash:function(t){this.storage.read(t)},_setKey:function(t){var e=this,a=t.name||e.get("name"),s=t.tab||e.get("tab"),n=t.user||e.get("user");"item"===s&&(s="baobei"),e.storageKey=r+a+s+n,e.set("tab",s),e.set("name",a),e.set("user",n),this.datalist=null},_save:function(e,a){if(!e.match(/<>'"/)&&!a.match(/<>'"/)){var s=this._getDatalist(),n=encodeURIComponent(e),i={key:n,value:encodeURIComponent(a),time:t.now()};this._deleteItemByValue(s,n),s.unshift(i)}},_deleteItemByValue:function(t,e){for(var a,s=null,n=0;n<t.length;n++)a=t[n].key,a==e&&(s=t.splice(n,1),n--)},_query:function(e){var a,s,n=this._getDatalist(),i=[];return e?(e=encodeURIComponent(e),t.each(n,function(t,n){a=t.key,s=t.value,(0===a.indexOf(e)||0===s.indexOf(e))&&i.push(t)}),this._distinctByValue(i)):this._distinctByValue(n)},_distinctByValue:function(t){for(var e,a=[],s=0,n=t.length;n>s;s++)e=t[s],e.value.match(/%3C|%3E|[<>'"]/g)||!this._hasItemOfValue(a,e.value)&&a.push(e);return a},_hasItemOfValue:function(t,e){for(var a=!1,s=t.length-1;s>=0;s--)t[s].value===e&&(a=!0);return a},_cleanBefore:function(t){for(var e,a=this._getDatalist(),s=0,n=a.length-1;n>=0;n--)if(e=a[n],e.time>t){s=n+1;break}a.length=s},_getDatalist:function(){return this.datalist||(this.datalist=this.storage.read()||[]),this.datalist},_getStorage:function(){var t=this.get("storageType");switch(t){case"flashStorage":this.storage=this._initFlashStorage();break;default:this.storage=!1}},_initFlashStorage:function(){var t=this;return{save:function(){return(new s).save(t.storageKey,a.stringify(t.datalist))},read:function(e){var i=(new s).read(t.storageKey,e);if(i){var r=a.parse(i);return r}return n}}},destructor:function(){this.datalist=null,r=null},save:function(e,a){if(""!=a){var s,n=this.storage.read();n&&(s=n.length);var i=this._save(e,a),r=this.storage.save();return s>300&&(this.datalist=this.datalist.slice(0,s-10),t.log("add_before\n"+r+"\n"+s),r=this.storage.save(),t.log("add_after\n"+r+"\n"+s)),i}},query:function(t){return this._query(t)},deleteItem:function(e){var a=this._getDatalist(),s=a.length;this._deleteItemByValue(a,encodeURIComponent(e));var n=this.storage.save();s>300&&(this.datalist=this.datalist.slice(0,s-10),n=this.storage.save(),t.log("delete\n"+n+"\n"+s))},clearByDay:function(e){var a=t.now()-24*e*3600*1e3;this._cleanBefore(a),this.storage.save()},hasHistory:function(){return this._getDatalist().length>0?!0:!1}},{ATTRS:{name:{value:"default",setter:function(t){return t}},user:{value:"",setter:function(e){return t.fromUnicode(e)}},maxLength:{value:500},storageType:{value:"flashStorage",setter:function(t){return t},getter:function(t){return t}}}}),i},{requires:["base","json","../mods/storage"]});KISSY.add("tbc/search-suggest/1.4.7/mods/menu",function(e){var t=e.all,n=function(r){var o=this;o.opts=e.mix(n.defs,r),o.$wrap=t(o.opts.wrap),o.$menu=t(o.opts.menu),o.locs=[],o.rNow=null,o.tOut=null,o.init()};return n.defs={wrap:"",menu:"",rows:"",dealy:300,handler:null,tolerance:0},n.prototype.getOffset=function(){var e=this,t=e.opts,n=e.$menu,r=n.offset();e.menuOffset=r,e.upperRight={x:r.left+n.outerWidth(),y:r.top-t.tolerance},e.lowerRight={x:r.left+n.outerWidth(),y:r.top+n.outerHeight()+t.tolerance}},n.prototype.bindEvent=function(){var e,n,r,o=this,u=o.opts,l=o.locs,a=o.rNow,i=o.tOut,s=null,f=function(i){function f(e,t){return(t.y-e.y)/(t.x-e.x)}var c=!!t(i).one(u.cls);o.getOffset(),e=o.menuOffset,n=o.upperRight,r=o.lowerRight;var p=l[l.length-1],g=l[0];if(!a||!p)return 0;if(g.x<e.left||g.x>r.x||g.y<e.top||g.y>r.y)return 0;if(s&&p.x==s.x&&p.y==s.y)return 0;var h=f(p,n),d=f(p,r),y=f(g,n),m=f(g,r);return c&&y>h&&d>m?(s=p,u.dealy):(s=null,0)},c=function(e){a!=e&&(u.handler.enterHandler(e),a=e)},p=function(e,t){o.isDelay=t?!0:!1;var n=f(t);n?i=setTimeout(function(){p(o.currentTarget,o.currentTarget)},n):(o.isDelay=!1,c(e))},g=function(e){l.push({x:e.pageX,y:e.pageY}),l.length>3&&l.shift()},h=function(){a=null,u.handler.leaveHandler()},d=function(){o.isDelay=!1,a=null,i&&clearTimeout(i)},y=function(e){if(o.currentTarget=e.currentTarget,!o.isDelay){i&&clearTimeout(i);var n=e.relatedTarget,r=t(n).parent(u.rows);p(e.currentTarget,r)}};o.$wrap.on("mousemove",g).on("mouseleave",h),o.$menu.on("mouseleave",d).delegate("mouseenter",u.rows,y)},n.prototype.init=function(){this.getOffset(),this.bindEvent()},n},{requires:["node"]});KISSY.add("tbc/search-suggest/1.4.7/tpl/cloud",function(){return{navi:function(a){var t='<div id="J_CloudList'+a.prefix+'" data-align="false" class="J_cloud-handle cloud-navi-list" '+a.autoAttr+'> <div class="inner-wrap"> <a class="cloud-img-wrap" href="//'+a.data.url+"?source=suggest&suggest=navi_"+a.index+'_1" target="_self"> <img src="//img.alicdn.com/tps/i1/'+a.data.logo+'_70x70.jpg" /> </a> <p>'+a.data.title+'</p> <a class="cloud-btn-wrap" href="//'+a.data.url+"?source=suggest&suggest=navi_"+a.index+'_1" target="_self"> <span class="cloud-link">'+a.data.button+"</span><i>></i> </a> </div></div>";return t},qrcode:function(a){var t='<div id="J_CloudList'+a.prefix+'" data-align="false" class="J_cloud-handle cloud-qrcode" '+a.autoAttr+' > <div class="inner-wrap"> <a href="'+a.data.url+'"><img src="'+a.data.image+'"/></a> </div></div>';return t},spu:function(a){var t='<div id="J_CloudList'+a.prefix+'" data-align="false" class="J_cloud-handle cloud-spu-list" '+a.autoAttr+' > <div class="inner-wrap"> <ul> ',l=a.data;if(l)for(var s,i=-1,e=l.length-1;e>i;)s=l[i+=1],t+=' <li> <a class="cloud-img-wrap cloud-link" href="//'+s.url+"&source=suggest&suggest=spu_"+a.index+"_"+(~~i+1)+'" target="_self"> <img src="//img.alicdn.com/tps/i1/'+s.pic+'_50x50.jpg" /> </a> <a class="cloud-title" title="'+s.title+'" href="//'+s.url+"&source=suggest&suggest=spu_"+a.index+"_"+(~~i+1)+'" target="_self"> <span>'+s.title+'</span> </a> <p class="cloud-price '+(0===~~s.price?"cloud-hidden":"")+'">参考价:<b class="">￥'+s.price+'</b><b class="noprice">暂无</b></p> </li> ';return t+=' </ul> <p class="cloud-total '+a.ishidden+'"> <span class="total">共'+a.count+'款产品</span> <a class="more" target="_self" href="//'+a.link+"&source=suggest&suggest=spu_"+a.index+'_more">查看全部>></a> </p> </div></div>'},tag:function(a){var t='<div id="J_CloudList'+a.prefix+'" data-align="true" class="J_cloud-handle cloud-list" '+a.autoAttr+' > <div class="inner-wrap"><h3>'+a.tagTitle+"</h3> <ul> ",l=a.data;if(l)for(var s,i=-1,e=l.length-1;e>i;)s=l[i+=1],t+=' <li><a target="_self" href="'+a.action+"?q="+a.tagTitle+" "+s+"&wq="+a.query+"&source=suggest&suggest=magic_"+a.index+"_"+(~~i+1)+"&tag="+s+a.param+'" class="cloud-link"><span>'+s+"</span></a></li> ";return t+=" </ul> </div></div>"},tag_group:function(a){var t='<div id="J_CloudList'+a.prefix+'" data-align="true" class="J_cloud-handle cloud-list type-taggroup" '+a.autoAttr+' > <div class="inner-wrap"><h3>'+a.tagTitle+"</h3> <ul> ",l=a.data;if(l)for(var s,i=-1,e=l.length-1;e>i;){s=l[i+=1],t+=' <li  class="tag-group"> <ul> ';var r=s;if(r)for(var u,d=-1,n=r.length-1;n>d;)u=r[d+=1],t+=' <li> <a target="_self" href="'+a.action+"?q="+encodeURIComponent(a.tagTitle+" "+u.title)+"&wq="+a.query+"&source=suggest&suggest=magic_"+a.index+"_"+(~~d+1)+"&tag="+u.title+a.param+'" class="cloud-link '+u.type+'"><span>'+u.title+"</span></a> </li> ";t+=" </ul> </li> "}return t+=" </ul> </div></div>"},topbrand:function(a){var t='<div id="J_CloudList'+a.prefix+'" data-align="false" class="J_cloud-handle cloud-topbrand-list" '+a.autoAttr+' > <div class="inner-wrap"> <h3>“'+a.tagTitle.substr(0,11)+"”热门品牌</h3><ul> ",l=a.data;if(l)for(var s,i=-1,e=l.length-1;e>i;)s=l[i+=1],t+=' <li> <a class="cloud-title cloud-link" href="//'+s.url+"&source=suggest&suggest=brandlist_"+a.index+"_"+(~~i+1)+'" target="_self"> <span><i class="cloud-top'+i+'">'+(~~i+1)+"</i>"+s.title+"</span> </a> </li> ";return t+=" </ul> </div></div>"}}});