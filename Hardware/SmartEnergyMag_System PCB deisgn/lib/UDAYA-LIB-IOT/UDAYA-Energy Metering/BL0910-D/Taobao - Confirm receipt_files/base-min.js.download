var TB=YAHOO.namespace("TB");YAHOO.namespace("TB.app.Trade"),YAHOO.lang.augmentObject(TB.app.Trade,function(){var Y=YAHOO.util,Dom=Y.Dom,Event=Y.Event,G=Y.Get,C=YAHOO.util.Connect,Trade=TB.app.Trade;return{ListSelector:function(e){var t={checkCount:0,selectors:[],allSelectors:[],MAX_COUNT:0,ALL_COUNT:0,init:function(e){this.selectors=Dom.getElementsByClassName("selector","input",e),this.allSelectors=Dom.getElementsByClassName("all-selector","input",e),this.MAX_COUNT=this.selectors.length,this.ALL_COUNT=this.allSelectors.length,this.initAllSelectors(),this.initSelectors()},initAllSelectors:function(){Dom.batch(this.allSelectors,function(e){Event.on(e,"click",function(){var e=this.checked;t.checkedCount=e?t.MAX_COUNT:0;for(var o=0;o<t.MAX_COUNT;++o)t.selectors[o].checked=e;for(o=0;o<t.ALL_COUNT;++o)t.allSelectors[o].checked=e})})},initSelectors:function(){Dom.batch(this.selectors,function(e){Event.on(e,"click",function(){if(e.checked){if(t.checkedCount++,t.checkedCount==t.MAX_COUNT)for(o=0;o<t.ALL_COUNT;++o)t.allSelectors[o].checked=!0}else{for(var o=0;o<t.ALL_COUNT;++o)t.allSelectors[o].checked=!1;t.checkedCount--}})})}};return t.init(e),t},DialogMgr:{currentDialog:null,currentTrigger:null,initTriggers:function(e){for(var t=Dom.getElementsByClassName("J_DialogTrigger","*",e||document.body),o=this,n=0,a=t.length;n<a;++n)Event.on(t[n],"click",function(e){Event.preventDefault(e);var t=this.href,n=Trade.Util.parseQueryString(this.getAttribute("data"));o.currentTrigger=this,Trade.DialogMgr.showDialog(t,n)})},initDialogCloseBtn:function(){Event.on("J_ContainerClose","click",function(){parent.TB.app.Trade.DialogMgr.hideDialog()})},initDialog:function(e){e=e||{},e.width=e.width||"690px",e.height=e.height||"280px",e.visible=e.visible||!1,e.modal=e.modal!==!1,e.draggable=e.draggable||!1,e.close=e.close!==!1;var t="J_Dialog",o=Dom.get(t);o=document.createElement("div"),o.id=t,Dom.addClass(o,"dialog");var n=document.createElement("iframe");n.name="dialogFrame",n.style.width=parseInt(e.width)-20+"px",n.style.height=parseInt(e.height)-20+"px",n.setAttribute("frameBorder","0"),n.setAttribute("scrolling","no"),n.src="about: blank";var a=document.createElement("div");Dom.addClass(a,"bd"),a.appendChild(n),o.appendChild(a),document.body.appendChild(o),document.body.appendChild(o),this.currentDialog=new YAHOO.widget.Panel(o,e),this.currentDialog.render(),Dom.addClass(document.body,"yui-skin-sam");var r=Dom.getElementsByClassName("container-close","a",o);1==r.length&&(r=r[0],Event.purgeElement(r),Event.on(r,"click",function(e){Event.preventDefault(e),this.hideDialog()},this,!0));var i=this;recalcTimer=null,Event.on(window,"resize",function(){null!==recalcTimer&&recalcTimer.cancel(),recalcTimer=YAHOO.lang.later(200,this,function(){i.currentDialog.center()})})},showDialog:function(e,t){this.currentDialog||this.initDialog(t),e.indexOf("?")==-1&&(e+="?"),e+="&t="+(new Date).getTime(),Dom.get("J_Dialog").getElementsByTagName("iframe")[0].src=e,this.currentDialog.center(),this.currentDialog.show(),$("card_info").className="covered"},hideDialog:function(e){if("undefined"==typeof e&&(e=!1),e){var t=confirm("\u786e\u8ba4\u5173\u95ed\u7a97\u53e3\u4e48\uff1f");if(!t)return!1}$("card_info").className="",Event.purgeElement(window,!1,"resize"),Dom.get("J_Dialog").getElementsByTagName("iframe")[0].src="about:blank",this.currentDialog.hide();var o=Dom.get("J_Dialog_c"),n=Dom.get("J_Dialog_mask"),a=Dom.get("_yuiResizeMonitor");o.parentNode.removeChild(o),n.parentNode.removeChild(n),a.parentNode.removeChild(a),this.currentDialog=null}},TradeOperations:{ModifyPrice:function(e){function t(){var e=String(this.value),t=e.lastIndexOf(".");if(!(t<0||e.length<t+1)){var o=e.substring(t+1);o.length>2&&(this.value=e.substring(0,t)+"."+o.substring(0,2))}}function o(){for(var e=0,t=p.length;e<t;++e){var o=p[e],n=YAHOO.lang.trim(o.value);if(""==n&&(o.value="0",n=0),parseFloat(n)!=n)return Dom.removeClass(l,"hidden"),o.focus(),!1}var a=YAHOO.lang.trim(d.value);return!(parseFloat(a)<0)||(Dom.removeClass(l,"hidden"),d.focus(),!1)}if(e=Dom.get(e)){var n=parseFloat(Dom.get("J_OriginalPrice").innerHTML),a=Dom.get("J_PostFee"),r=Dom.get("J_AdjustFee"),i=Dom.get("J_TotalPrice"),l=Dom.get("J_ErrorMsg"),s=e.elements.adjustFee,d=e.elements.postFee,m=Dom.get("J_InitAdjustFee"),u=0;m&&(u=parseFloat(m.getAttribute("data-value")));var c=!!e.elements.discount;if(c)var g=e.elements.discount,v=g.getAttribute("data-value");var p=[];s.length||(s=[s]);for(var h=0,f=s.length;h<f;++h)p.push(s[h]);p.push(d),Event.on(p,"blur",function(){if(o())try{var e=parseFloat(d.value).toFixed(2);a.innerHTML=e;for(var t=u,m=0,g=s.length;m<g;++m){var p=YAHOO.lang.trim(s[m].value);t+=parseFloat(p)}var h="";h=t<0?"- "+Math.abs(t).toFixed(2):"+ "+Math.abs(t).toFixed(2),r.innerHTML=h;var f=parseFloat(n)+parseFloat(e)+parseFloat(t);c&&(f-=v),f<=0?Dom.removeClass(l,"hidden"):Dom.addClass(l,"hidden"),i.innerHTML=f.toFixed(2)}catch(D){Dom.removeClass(l,"hidden")}}),Event.on(e,"submit",function(e){Dom.hasClass(l,"hidden")||(Event.preventDefault(e),Trade.Util.twinkleErrorBox(l))}),Event.on(p,"input",t),Event.on(p,"propertychange",t)}},CancelOrder:function(e){e=Dom.get(e),e&&Event.on(e,"submit",function(e){0==Dom.get("J_CloseReason").selectedIndex&&(Event.preventDefault(e),Dom.removeClass("J_ErrorMsg","hidden"),Trade.Util.twinkleErrorBox("J_ErrorMsg"))})}},Callback:{CommonOperation:function(){return Trade.DialogMgr.hideDialog(),Dom.get("list-sold-items")!=document.body&&(window.location.reload(),!0)},ModifyPrice:function(e,t,o){if(!this.CommonOperation()&&e){var n=Dom.get("order"+e);if(n){var a=Dom.getElementsByClassName("J_OrderPrice","",n)[0];a&&"undefined"!=typeof t&&(a.innerHTML="",a.appendChild(document.createTextNode(t)));var r=Dom.getElementsByClassName("J_PostFee","",n)[0];r&&"undefined"!=typeof o&&(r.innerHTML="",r.appendChild(document.createTextNode(o)))}}},CloseTrade:function(e){if(!this.CommonOperation()&&e){var t=Dom.get("order"+e);if(t){var o=Dom.getElementsByClassName("trade-status","",t)[0];o&&(o.innerHTML='<strong class="closed">\u4ea4\u6613\u5173\u95ed<strong>');var n=Dom.getElementsByClassName("trade-actions","",t)[0];if(n){var a=Dom.getElementsByClassName("J_ComplainBtn","a",n)[0],r="";a&&(r=a.parentNode.innerHTML,r='<span class="skin-gray">'+r+"</span>"),n.innerHTML=r}}}},DelayTrade:function(e){if(!this.CommonOperation()&&e){var t=Dom.get("order"+e);t&&alert("\u6210\u529f\u5ef6\u957f\u8ba2\u5355 "+e+" \u7684\u8d85\u65f6\u65f6\u95f4\u3002")}}},Util:{togglePanel:function(e,t,o){e=Dom.get(e),t=Dom.get(t),e&&t&&Event.on(e,"click",function(n){Event.preventDefault(n);var a="none"!=t.style.display;t.style.display=a?"none":"block",o&&o(e,t)})},checkRefundQueryForm:function(){var e=(Dom.get("pageNum"),Dom.get("orderId")),t=Dom.get("refundApplyTime"),o=Dom.get("yearTo"),n=Dom.get("monthFrom"),a=Dom.get("monthTo"),r=Dom.get("refundId"),i=Dom.get("refundStatus"),l=Dom.get("payStatus"),s=Dom.get("interveneStatus"),d=Dom.get("askForTime"),m=Dom.get("outTime"),u=Dom.get("timeBegin"),c=Dom.get("timeEnd"),g=Dom.get("order_id").value,v=Dom.get("refund-apply-date").options[Dom.get("refund-apply-date").selectedIndex].value,p=Dom.get("year"),h=Dom.get("month-from"),f=Dom.get("month-to"),D=Dom.get("bizOrderTimeBegin"),C=Dom.get("bizOrderTimeEnd");if(p&&p.selectedIndex>-1){var p=p.options[p.selectedIndex].value;o.value=p}if(h&&h.selectedIndex>-1){var h=h.options[h.selectedIndex].value;n.value=h}if(f&&f.selectedIndex>-1){var f=f.options[f.selectedIndex].value;a.value=f}D&&(u.value=D.value),C&&(c.value=C.value);var T=Dom.get("refund_id").value,y=Dom.get("J_RefundStatus").options[Dom.get("J_RefundStatus").selectedIndex].value,E=Dom.get("J_PayStatus").options[Dom.get("J_PayStatus").selectedIndex].value,b=Dom.get("J_Intervene").options[Dom.get("J_Intervene").selectedIndex].value,B="",x="";Dom.get("J_ApplyTime")&&(B=Dom.get("J_ApplyTime").options[Dom.get("J_ApplyTime").selectedIndex].value),Dom.get("J_OutTime")&&(x=Dom.get("J_OutTime").options[Dom.get("J_OutTime").selectedIndex].value),""!=g&&(e.value=g),""!=v&&(t.value=v),""!=T&&(r.value=T),""!=y&&(i.value=y),""!=E&&(l.value=E),b&&(s.value=b),""!=B&&(d.value=B),""!=x&&(m.value=x)},changePage:function(e){var t=document.getElementById("refundListQueryForm");t.pageNum.value=e,t.submit()},gotoPage:function(){Event.on("viewit","click",function(){var e=function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},t=function(e){var t=new RegExp("^-?\\d+$");return null!=e.match(t)},o=function(o){var n=e(o),a=parseInt(Dom.get("totalPage").value);return null==n||""==n?(alert("\u9875\u53f7\u65e0\u6548\uff01"),!1):t(n)?(n=parseInt(n),n>a?(alert("\u9875\u53f7\u8d85\u51fa\u6700\u5927\u9875\u53f7\uff01"),!1):!(n<1)||(alert("\u9875\u53f7\u8d85\u51fa\u6700\u5c0f\u9875\u53f7\uff01"),!1)):(alert("\u9875\u53f7\u5fc5\u987b\u4e3a\u6574\u6570\uff01"),!1)},n=Dom.get("pageNO").value;if(""!=n&&o(n)){var a=Dom.get("refundListQueryForm");a.pageNum.value=n,a.submit()}})},addRefundSearchEvent:function(){var e,t=new Date,o=t.getFullYear(),n=t.getMonth()+1,a=t.getDate(),r=o+"-"+n+"-"+a,i="bizOrderTimeBegin",l="bizOrderTimeEnd",s=Dom.get("year"),d=n,m=Dom.get("month-from"),u=Dom.get("month-to"),c="",g=Dom.get("onlineRefund").value,v=Dom.get("archiveRefund").value;Trade.Util.gotoPage();var p=function(){TB.widget.SimpleCalendar.init(D.get(i),null,null,{selected:r,enableSelectYear:!0}),TB.widget.SimpleCalendar.init(D.get(l),null,null,{selected:r,enableSelectYear:!0})};p();var h=Dom.getElementsByClassName("J_BatchExportPanelCloseBtn");Event.on(h,"click",function(e){var t=Event.getTarget(e),o=Dom.getAttribute(t,"value");Dom.addClass(o,"hidden")});for(var f=Dom.getElementsByClassName("J_GoToPage"),C=0,T=f.length;C<T;C++)Event.on(f[C],"click",function(e){var t=Event.getTarget(e),o=t.innerHTML;Trade.Util.changePage(o)});Event.on("J_BatchExportBtn","click",function(e){for(var t=["load-tips","loading-now","load-success","making-now","load-failure"],o=0,n=t.length;o<n;o++)Dom.addClass(t[o],"hidden");Dom.hasClass("msg-tips","hidden")?(Dom.removeClass("msg-tips","hidden"),Dom.addClass("J_LoadExportBtn","hidden"),Dom.removeClass("J_MakeExportBtn","hidden")):Dom.addClass("msg-tips","hidden")}),Event.on("J_RefundStatus","change",function(e){var t=Event.getTarget(e);t.options[t.selectedIndex].value}),Event.on("J_PayStatus","change",function(e){var t=Event.getTarget(e);t.options[t.selectedIndex].value}),Event.on("J_ApplyTime","change",function(e){var t=Event.getTarget(e),o=t.options[t.selectedIndex].value,n=Dom.get("askForTime");n.value=o;var a=Dom.get("refundListQueryForm"),r=Dom.get("refund-apply-date");if(0!=o){var i=Dom.get("outTime");i.value=0}0==r.options[r.selectedIndex].value?a.action=g:a.action=v,a.submit()});var y=Dom.getElementsByClassName("J_ChangeRole");Event.on(y,"click",function(e){var t=Event.getTarget(e),o=Dom.getAttribute(t,"value"),n=Dom.get("refundListQueryForm"),a=Dom.get("userRole");a.value=o;var r=Dom.get("refund-apply-date"),i=r.options[r.selectedIndex].value;Trade.Util.checkRefundQueryForm(),1==i?n.action=v:n.action=g,n.submit()}),Event.on("J_OutTime","change",function(e){var t=Event.getTarget(e),o=t.options[t.selectedIndex].value,n=Dom.get("outTime");n.value=o;var a=Dom.get("refundListQueryForm"),r=Dom.get("refund-apply-date");if(0!=o){var i=Dom.get("askForTime");i.value=0}0==r.options[r.selectedIndex].value?a.action=g:a.action=v,a.submit()}),Event.on("J_SearchOrders","click",function(e){Trade.Util.checkRefundQueryForm();var t=Dom.get("refundListQueryForm"),o=Dom.get("refund-apply-date");0==o.options[o.selectedIndex].value?t.action=g:t.action=v,t.submit()}),Event.on("J_LoadExportBtn","click",function(e){var t=Event.getTarget(e),o=Dom.getAttribute(t,"data-export-url");return""==c?(Dom.addClass("msg-tips","hidden"),void Dom.removeClass("load-failure","hidden")):(o=o+"?f_p="+c,window.location=o,Dom.removeClass("load-success","hidden"),void Dom.addClass("msg-tips","hidden"))});var E=function(e){var t="";if(e&&(t=e.errorCode,""!=t)){Dom.addClass("making-now","hidden"),Dom.removeClass("load-failure","hidden");var o=Dom.get("failTips");o.innerHTML=t+"<a title='\u5173\u95ed' href='#' class='close-btn J_BatchExportPanelCloseBtn' value='load-failure'>\u5173\u95ed</a>";var n=Dom.getElementsByClassName("J_BatchExportPanelCloseBtn");return Event.on(n,"click",function(e){var t=Event.getTarget(e),o=Dom.getAttribute(t,"value");Dom.addClass(o,"hidden")}),!1}return!0},b=function(t){YAHOO.util.Get.script(t,{onSuccess:function(){var o=window.resultExport,n=YAHOO.lang.JSON.parse(o);if(n){var a=n.exportStatus;if("exporting"==a)return void(null==e&&(e=setInterval(function(){b(t)},5e3)));if("exportSuccess"==a&&(clearInterval(e),c=n.f_p,Dom.hasClass("load-failure","hidden")&&(Dom.addClass("making-now","hidden"),Dom.removeClass("msg-tips","hidden"),Dom.addClass("J_MakeExportBtn","hidden"),Dom.removeClass("J_LoadExportBtn","hidden"))),"exportFail"==a){if(clearInterval(e),Dom.addClass("making-now","hidden"),Dom.hasClass("msg-tips","hidden")){Dom.removeClass("load-failure","hidden");var r=Dom.get("failTips");r.innerHTML="\u751f\u6210\u62a5\u8868\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u5c1d\u8bd5!<a title='\u5173\u95ed' href='#' class='close-btn J_BatchExportPanelCloseBtn' value='load-failure'>\u5173\u95ed</a>";var i=Dom.getElementsByClassName("J_BatchExportPanelCloseBtn");Event.on(i,"click",function(e){var t=Event.getTarget(e),o=Dom.getAttribute(t,"value");Dom.addClass(o,"hidden")})}return}}},onFailure:function(o){null==e&&(e=setInterval(function(){b(t)},5e3))},timeout:1e4,charset:"gbk"})};Event.on("J_MakeExportBtn","click",function(e){var t=Event.getTarget(e),o=new Date;o.getTime();Dom.addClass("msg-tips","hidden"),Dom.removeClass("making-now","hidden");var n=Dom.getAttribute(t,"data-export-url"),a=Dom.get("refundListQueryForm");Trade.Util.checkRefundQueryForm();for(var r=Dom.getChildren(a),i=new Array,l=0,s=r.length;l<s;l++)""!=r[l].name&&null!=r[l].name&&i.push(r[l].name+"="+r[l].value);var d=i.join("&");n=n+"?"+d,YAHOO.util.Get.script(n,{onSuccess:function(){var e=window.resultReport,t=YAHOO.lang.JSON.parse(e);if(E(t)&&t){var o=t.exportId,n=t.sellerId,a=Dom.get("checkExportUrl").value;a=a+"?sellerId="+n+"&exportId="+o,b(a)}},onFailure:function(){alert("\u7cfb\u7edf\u7e41\u5fd9\u8bf7\u7a0d\u540e\u518d\u8bd5")},timeout:1e4,charset:"gbk"})});for(var B=o;B>=o-8;B--){var x=document.createElement("option");x.value=B,x.innerHTML=B+"\u5e74",s.appendChild(x),B==o&&(x.selected=!0)}var _=function(e){m.options&&(m.options.length=0),u.options&&(u.options.length=0);for(var t=Dom.get("year"),a=0,r=t.length;a<r;a++)t.options[a].value==e&&(t.options[a].selected=!0);if(e==o){for(var i=1;i<=n;i++){var l=document.createElement("option");l.value=i,l.innerHTML=i+"\u6708",i==n&&(l.selected=!0),m.appendChild(l)}if(1==n){var l=document.createElement("option");l.value=n,l.innerHTML=n+"\u6708",l.selected=!0,u.appendChild(l)}else for(var i=2;i<=n;i++){var l=document.createElement("option");l.value=i,l.innerHTML=i+"\u6708",i==n&&(l.selected=!0),u.appendChild(l)}}else{for(var i=1;i<=12;i++){var l=document.createElement("option");l.value=i,l.innerHTML=i+"\u6708",1==i&&(l.selected=!0),m.appendChild(l)}for(var i=2;i<=12;i++){var l=document.createElement("option");l.value=i,l.innerHTML=i+"\u6708",12==i&&(l.selected=!0),u.appendChild(l)}}};Event.on("year","change",function(e){var n=Event.getTarget(e),a=n.options[n.selectedIndex].value;d=a!=o?12:t.getMonth()+1,_(a)});var I=function(e){for(var t=e.options[e.selectedIndex].value,o=0,n=0;n<u.options.length;n++)u.options[n].selected&&(o=u.options[n].value);u.options.length=0;for(var n=t;n<=d;n++){var a=document.createElement("option");a.value=n,a.innerHTML=n+"\u6708",n==o&&(a.selected=!0),u.appendChild(a)}};Event.on("month-from","change",function(e){var t=Event.getTarget(e);I(t)}),Event.on("month-to","change",function(e){for(var t=Event.getTarget(e),o=t.options[t.selectedIndex].value,n=0,a=0;a<m.options.length;a++)m.options[a].selected&&(n=m.options[a].value);m.options.length=0;for(var a=1;a<=o;a++){var r=document.createElement("option");r.value=a,r.innerHTML=a+"\u6708",a==n&&(r.selected=!0),m.appendChild(r)}}),Event.on("refund-apply-date","change",function(e){var t=Event.getTarget(e),n=t.options[t.selectedIndex].value;if(0==n){Dom.addClass("year","hidden"),Dom.addClass("month-from","hidden"),Dom.addClass("month-to","hidden"),Dom.removeClass("bizOrderTimeBegin","hidden"),Dom.removeClass("bizOrderTimeEnd","hidden");for(var a=Dom.getElementsByClassName("J_DisplayLayer"),r=0,i=a.length;r<i;r++)Dom.removeClass(a[r],"visible")}else{Dom.removeClass("year","hidden"),Dom.removeClass("month-from","hidden"),Dom.removeClass("month-to","hidden"),Dom.addClass("bizOrderTimeBegin","hidden"),Dom.addClass("bizOrderTimeEnd","hidden");for(var a=Dom.getElementsByClassName("J_DisplayLayer"),r=0,i=a.length;r<i;r++)Dom.addClass(a[r],"visible");_(o)}});var O=Dom.get("refund-apply-date"),J=O.options[O.selectedIndex].value;if(1==J){Dom.removeClass("year","hidden"),Dom.removeClass("month-from","hidden"),Dom.removeClass("month-to","hidden"),Dom.addClass("bizOrderTimeBegin","hidden"),Dom.addClass("bizOrderTimeEnd","hidden");var k=Dom.get("yearTo").value,A=Dom.get("monthFrom").value,L=Dom.get("monthTo").value;if(k){for(var M=Dom.get("year"),C=0,T=M.options.length;C<T;C++)M.options[C].value==k&&(M.options[C].selected=!0);var w=M.options[M.selectedIndex].value;w!=o&&(d=12),_(k);for(var N=Dom.get("month-from"),S=new Array,C=0,T=N.options.length;C<T;C++)N.options[C]&&N.options[C].value==A&&(N.options[C].selected=!0),N.options[C]&&parseInt(N.options[C].value)>parseInt(L)&&S.push(N.options[C]);for(var B=0,T=S.length;B<T;B++)1==S[B].nodeType&&N.removeChild(S[B]);var P=Dom.get("month-to"),H=new Array;I(N);for(var C=0,T=P.options.length;C<T;C++)P.options[C]&&P.options[C].value==L&&(P.options[C].selected=!0),P.options[C]&&parseInt(P.options[C].value)<parseInt(A)&&H.push(P.options[C]);for(var B=0,T=H.length;B<T;B++)1==H[B].nodeType&&H.removeChild(H[B])}else _(o)}},toggleOrderDetail:function(e){for(var t=Dom.getElementsByClassName("hidden-detail","tbody",e),o=0,n=t.length;o<n;++o)!function(){var e=t[o],n=Dom.getElementsByClassName("order-hd","tr",e);Event.on(n,"click",function(t){var o=Event.getTarget(t).tagName;"INPUT"!=o&&"A"!=o&&(Dom.hasClass(e,"hidden-detail")?Dom.replaceClass(e,"hidden-detail","display-detail"):Dom.replaceClass(e,"display-detail","hidden-detail"))})}()},initUserInfoPopup:function(trigger){if(trigger&&trigger.getAttribute("data")){var img=trigger.getElementsByTagName("img");img&&img.length>0&&img[0].setAttribute("alt","");var infoBox=document.createElement("div");Dom.addClass(infoBox,"popup-info-box");var htmlCode='<div class="bl"><div class="br">';htmlCode+='<div class="bd user-info">',htmlCode+="\u6b63\u5728\u52a0\u8f7d\u2026\u2026",htmlCode+="</div>",htmlCode+="</div></div>",htmlCode+='<div class="bt"><div class="corner bt-l"></div><div class="mid"></div><div class="corner bt-r"></div></div>',infoBox.innerHTML=htmlCode,document.body.appendChild(infoBox),TB.widget.SimplePopup.decorate(trigger,infoBox,{offset:[0,-15],position:"right",effect:"fade",disableClick:!1,onShow:function(){if(Dom.setStyle(infoBox,"display","block"),!(infoBox.getElementsByTagName("h5").length>0)){var infoBoxBd=Dom.getElementsByClassName("user-info","div",infoBox)[0],url=trigger.getAttribute("data");YAHOO.util.Connect.asyncRequest("GET",url,{success:function(o){try{var userInfo=eval("("+o.responseText+")"),htmlCode="";(userInfo.name||userInfo.tel||userInfo.mobile||userInfo.otherPhone||userInfo.email||userInfo.city)&&(htmlCode="<h5>\u8054\u7cfb\u4fe1\u606f</h5>"),htmlCode+='<table class="user-info-table"><tbody>',userInfo.name&&(htmlCode+="<tr><th>\u59d3\u540d\uff1a</th><td>"+userInfo.name+"</td></tr>"),userInfo.tel&&(htmlCode+="<tr><th>\u7535\u8bdd\uff1a</th><td>"+userInfo.tel+"</td></tr>"),userInfo.mobile&&(htmlCode+="<tr><th>\u624b\u673a\uff1a</th><td>"+userInfo.mobile+"</td></tr>"),userInfo.otherPhone&&(htmlCode+="<tr><th>\u5907\u7528\u7535\u8bdd\uff1a</th><td>"+userInfo.otherPhone+"</td></tr>"),userInfo.email&&(htmlCode+="<tr><th>\u7535\u5b50\u90ae\u4ef6\uff1a</th><td>"+userInfo.email+"</td></tr>"),userInfo.city&&(htmlCode+="<tr><th>\u57ce\u5e02\uff1a</th><td>"+userInfo.city+"</td></tr>"),htmlCode+='<tr class="sep"><td colspan="2"><hr></td></tr>',htmlCode+=userInfo.message?'<tr><th>\u4e70\u5bb6\u7559\u8a00\uff1a</th><td class="message">'+userInfo.message+"</td></tr>":'<tr><th>\u4e70\u5bb6\u7559\u8a00\uff1a</th><td class="message">\u65e0</td></tr>',htmlCode+='<tr class="sep"><td colspan="2"><hr></td></tr>';var attachCode="";if(userInfo.attachInfo)for(key in userInfo.attachInfo)attachCode+="<tr><th>"+key+"\uff1a</th><td>"+userInfo.attachInfo[key]+"</td></tr>";attachCode.length>0&&(htmlCode+=attachCode),htmlCode+="</tbody></table>";var linkCode="";userInfo.buyerAddress&&userInfo.buyerAddress.length>0&&(linkCode+='<div><a href="'+userInfo.buyerAddress+'" target="_blank">\u67e5\u770b\u6536\u8d27\u5730\u5740</a></div>'),htmlCode+=linkCode,infoBoxBd.innerHTML=htmlCode}catch(e){infoBoxBd.innerHTML="\u5bf9\u4e0d\u8d77\uff0c\u6682\u65f6\u65e0\u6cd5\u83b7\u5f97\u6570\u636e\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5\u3002"}},failure:function(){infoBoxBd.innerHTML="\u5bf9\u4e0d\u8d77\uff0c\u6682\u65f6\u65e0\u6cd5\u83b7\u5f97\u6570\u636e\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5\u3002"}})}}})}},initMemoInfo:function(){var e=document.createElement("div");e.id="J_MemoPopup",Dom.addClass(e,"memo-popup"),document.body.appendChild(e),Dom.getElementsByClassName("J_MemoFlag","a","J_ListTable",function(t){var o=t.getAttribute("title");o?(t.setAttribute("data",o),t.setAttribute("title",""),t.getElementsByTagName("img")[0].setAttribute("alt","")):t.setAttribute("data","\u6682\u65f6\u6ca1\u6709\u5907\u5fd8\u5f55\u4fe1\u606f"),TB.widget.SimplePopup.decorate(t,e.id,{effect:"fade",autoFit:!0,eventType:"mouse",disableClick:!1,delay:.1,position:"left",offset:[25,15],onShow:function(){this.popup.innerHTML=this.trigger.getAttribute("data")},onHide:function(){this.popup.innerHTML=""}})})},initXBCardPopup:function(){var e=document.createElement("div");e.id="XBCardPopup",e.setAttribute("style","background: #fff;width: 602px; display: none; z-index: 999999"),e.innerHTML='<iframe id="XBCardFrame" src="about:blank" width="602" height="302" frameborder="0" scrolling="no"></iframe>',document.body.appendChild(e);var t=Dom.getElementsByClassName("J_XBCard","a","J_ListTable");TB.widget.SimplePopup.decorate(t,e.id,{width:602,height:402,position:"bottom",eventType:"click",offset:[-500,-100],onShow:function(){Dom.get("XBCardFrame").src=this.trigger.href}})},initReasonPopup:function(){var e=Dom.getElementsByClassName("J_ViewReason","A",document.body,function(e){e.setAttribute("data-reason",e.title),e.title=""});if(0!==e.length){var t=document.createElement("div");t.id="ReasonPopup",t.className="popup-info-box",t.setAttribute("style","display: none;");var o='<div class="bl"><div class="br">';o+='<div class="bd" id="CanceledReason" style="padding:10px 25px 5px 10px;">',o+="\u53d6\u6d88\u539f\u56e0",o+="</div>",o+="</div></div>",o+='<div class="bt"><div class="corner bt-l"></div><div class="mid"></div><div class="corner bt-r"></div></div>',t.innerHTML=o,document.body.appendChild(t),TB.widget.SimplePopup.decorate(e,t.id,{disableClick:!0,offset:[-25,-10],onShow:function(){Dom.get("CanceledReason").innerHTML=this.trigger.getAttribute("data-reason")}})}},twinkleErrorBox:function(e,t){var o=Dom.get(e);if(o=Dom.getFirstChild(o)){t=t||2;var n=!0,a=YAHOO.lang.later(200,null,function(){Dom.setStyle(o,"borderWidth",n?"0":"1px"),n=!n},null,!0);YAHOO.lang.later(1e3*t,null,function(){Dom.setStyle(o,"borderWidth","1px"),a.cancel()})}},parseQueryString:function(e,t,o){if(!e||!e.length)return{};for(var n,a,r,i={},l=e.split(o||"&"),s=0,d=l.length;s<d;++s)n=l[s].split("="),a=decodeURIComponent(n[0]),r=decodeURIComponent(n[1]),""!==r&&"undefined"!==r||(r=void 0),t===!0?i[a]=r:"undefined"==typeof i[a]?i[a]=r:"string"==typeof i[a]?(i[a]=[i[a]],i[a].push(r)):i[a].push(r);return i}},PageInit:function(e){function t(){Trade.Util.togglePanel("J_SearchBoxToggle","J_SearchBox",function(e){Dom.hasClass(e,"collapsed-tool-toggle")?Dom.removeClass(e,"collapsed-tool-toggle"):Dom.addClass(e,"collapsed-tool-toggle")})}function o(){Trade.Util.togglePanel("J_RefundHelpBoxToggle","J_RefundHelpBox",function(e){var t=e.parentNode;Dom.hasClass(t,"collapsed")?Dom.removeClass(t,"collapsed"):Dom.addClass(t,"collapsed")})}if("list-sold-items"!=e&&"list-bought-items"!=e||(t(),new Trade.ListSelector("J_ListTable"),Dom.getElementsByClassName("J_UserInfo","span","J_ListTable",function(e){Trade.Util.initUserInfoPopup(e)}),Trade.Util.initMemoInfo()),"list-bought-items"==e&&Trade.Util.initXBCardPopup(),"list-sold-items"==e&&(Trade.Util.togglePanel("J_BatchExportBtn","J_BatchExportPanel"),Trade.Util.togglePanel("J_BatchExportPanelCloseBtn","J_BatchExportPanel")),Trade.Util.addRefundSearchEvent(),"trade-order-detail"==e){var n=TB.widget.SimpleTab.decorate("J_TabView",{eventType:"mouse",currentClass:"current",tabPanelClass:"info-box"}),a=location.hash;if(a&&5==a.length){var r=a.substring(4);n.switchTab(r)}Trade.Util.initReasonPopup()}if("list-sold-items"==e||"list-bought-items"==e||"trade-order-detail"==e){var i=Dom.getElementsByClassName("J_DialogTrigger","*",document.body);if(0==i.length)return;var l=new Y.YUILoader({require:["container"],base:"//assets.alicdn.com/yui/2.6.0/build/",onSuccess:function(){Trade.DialogMgr.initTriggers()},onFailure:function(e){alert("error: "+YAHOO.lang.dump(e))}});l.insert()}"modify-price"==e&&Trade.TradeOperations.ModifyPrice(document.forms.modifyPriceForm),"cancel-order"==e&&Trade.TradeOperations.CancelOrder(document.forms.cancelOrderForm),"modify-price"!=e&&"cancel-order"!=e&&"delay-trade"!=e&&"batch-pay"!=e||Trade.DialogMgr.initDialogCloseBtn(),"my-point"==e&&t(),"refund-list"==e&&o()}}}());